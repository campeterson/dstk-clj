(ns dstk-clj.core-test
  (:use expectations
        dstk-clj.core))

; street2coordinates
(expect {"2543 Graystone Pl, Simi Valley, CA 93065" {"locality" "Simi Valley", "fips_county" "06111", "street_number" "2543", "street_name" "Graystone Pl", "confidence" 1.0, "latitude" 34.280874, "longitude" -118.766282, "country_name" "United States", "region" "CA", "country_code" "US", "street_address" "2543 Graystone Pl", "country_code3" "USA"}}
        (street2coordinates "2543 Graystone Pl, Simi Valley, CA 93065"))

; geocode
(expect {"results" [{"geometry" {"viewport" {"southwest" {"lng" -118.767282, "lat" 34.279874}, "northeast" {"lng" -118.765282, "lat" 34.281874}}, "location_type" "ROOFTOP", "location" {"lng" -118.766282, "lat" 34.280874}}, "formatted_address" "2543 Graystone Pl, Simi Valley, CA 93065", "address_components" [{"short_name" "2543", "long_name" "2543", "types" ["street_number"]} {"short_name" "Graystone Pl", "long_name" "Graystone Pl", "types" ["route"]} {"short_name" "Simi Valley", "long_name" "Simi Valley", "types" ["locality" "political"]} {"short_name" "CA", "long_name" "CA", "types" ["administrative_area_level_1" "political"]} {"short_name" "US", "long_name" "United States", "types" ["country" "political"]}], "types" ["street_address"]}], "status" "OK"}
        (geocode "2543 Graystone Pl, Simi Valley, CA 93065"))

; coordinates2politics
(expect [{"politics"  [{"type" "admin2", "friendly_type" "country", "name" "United States", "code" "usa"}  {"type" "admin4", "friendly_type" "state", "name" "California", "code" "us06"}  {"type" "admin6", "friendly_type" "county", "name" "San Francisco", "code" "06_075"}  {"type" "admin5", "friendly_type" "city", "name" "San Francisco", "code" "06_67000"}  {"type" "constituency", "friendly_type" "constituency", "name" "Eighth district, CA", "code" "06_08"}  {"type" "neighborhood", "friendly_type" "neighborhood", "name" "Castro-Upper Market", "code" "Castro-Upper Market|San Francisco|CA"}], "location"  {"latitude" 37.769456, "longitude" -122.429128}}]
        (coordinates2politics [37.769456 -122.429128]))

; text2sentimentent
(expect {"score" 3.0}
        (text2sentiment "I love this hotel!"))

; coordinates2statistics
(expect
  [{"statistics" {"us_housing_units_no_vehicle" {"description" "The proportion of occupied housing units with no vehicle available.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.00943396226415094}, "us_housing_units_one_person" {"description" "The proportion of housing units containing only one person", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.12533692722372}, "us_sample_area" {"description" "The total area of the grid cell US Census samples were calculated on.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "units" "square meters", "value" 709793}, "us_housing_units_1970_to_1989" {"description" "The proportion of housing units built between 1970 and 1989.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.539083557951482}, "land_cover" {"description" "What type of environment exists around this point - urban, water, vegetation, mountains, etc.", "index" 22, "source_name" "European Commission Land Resource Management Unit Global Land Cover 2000", "value" "Artificial surfaces and associated areas"}, "us_households_single_mothers" {"description" "The proportion of households with a female householder, no husband, and one or more children under eighteen.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 727, "value" 0.0894085281980743}, "precipitation" {"description" "The monthly average total precipitation at this point.", "source_name" "WorldClim", "units" "millimeters", "value" [96 95 74 30 5 1 0 3 7 11 68 64]}, "us_population_foreign_born" {"description" "The proportion of residents who were born in a different country.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.162576687116564}, "us_population_low_income" {"description" "The proportion of residents who earn less than twice the poverty level", "source_name" nil, "proportion_of" 2282, "value" 0.161700262927257}, "us_housing_units_1950_to_1969" {"description" "The proportion of housing units built between 1950 and 1969.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.432614555256065}, "us_population_native_hawaiian_and_other_pacific_islander" {"description" "The proportion of residents who identify as Native Hawaiian or other Pacific islander.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.00262927256792287}, "us_housing_units" {"description" "The total number of housing units in this area", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "value" 742}, "us_population" {"description" "The number of residents in this area", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "value" 2282}, "us_population_severe_poverty" {"description" "The proportion of residents whose income is below half the poverty level.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0184049079754601}, "us_housing_units_before_1950" {"description" "The proportion of housing units built before 1950.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.0}, "us_housing_units_vacation" {"description" "The number of vacant housing units that are used for seasonal, recreational, or occasional use.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.0}, "us_housing_units_occupied" {"description" "The proportion of housing units that are occupied.", "source_name" nil, "proportion_of" 742, "value" 0.979784366576819}, "us_households_linguistically_isolated" {"description" "The proportion of households in which no one aged 14 or older speaks English very well", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 727, "value" 0.0275103163686382}, "us_population_twenty_five_to_sixty_four_years_old" {"description" "The proportion of residents aged twenty five to sixty four years old.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.55521472392638}, "us_population_asian" {"description" "The proportion of residents identifying as Asian.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0929009640666082}, "us_population_one_to_four_years_olds" {"description" "The proportion of residents aged one to four years old.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0644171779141104}, "us_households" {"description" "The number of households in this area.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "value" 727}, "us_housing_units_after_1990" {"description" "The proportion of housing units built after 1990.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.032345013477089}, "population_density" {"description" "The number of inhabitants per square kilometer around this point.", "source_name" "NASA Socioeconomic Data and Applications Center (SEDAC) – Hosted by CIESIN at Columbia University", "value" 1742}, "us_population_under_one_year_old" {"description" "The proportion of residents under one year of age.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0153374233128834}, "us_population_black_or_african_american" {"description" "The proportion of residents identifying as black or African American.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0162138475021911}, "us_population_bachelors_degree" {"description" "The proportion of residents whose maximum educational attainment was a bachelor's degree.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.124452234881683}, "us_population_white" {"description" "The proportion of residents who identify themselves as white.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.755915863277826}, "us_population_over_seventy_nine_years_old" {"description" "The proportion of residents over seventy nine years old.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0122699386503067}, "us_population_white_not_hispanic" {"description" "The proportion of residents who didn't identify as hispanic or latino, just white alone", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.665644171779141}, "us_population_poverty" {"description" "The proportion of residents whose income is below the poverty level", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0398773006134969}, "us_population_black_or_african_american_not_hispanic" {"description" "The proportion of residents who didn't identify as hispanic or latino, just black or African American alone", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0162138475021911}, "mean_temperature" {"description" "The mean monthly temperature at this point.", "source_name" "WorldClim", "units" "degrees Celsius", "value" [11.3 12.2 12.8 14.6 16.5 19.3 22.3 22.6 21.0 18.1 14.2 11.5]}, "elevation" {"description" "The height of the surface above sea level at this point.", "source_name" "NASA and the CGIAR Consortium for Spatial Information", "units" "meters", "value" 271}, "us_housing_units_owner_occupied" {"description" "The proportion of housing units that are occupied by their owners.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 742, "value" 0.528301886792453}, "us_population_sixty_five_to_seventy_nine_years_old" {"description" "The proportion of residents aged sixty five to seventy nine years old.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.0376862401402279}, "us_population_hispanic_or_latino" {"description" "The proportion of residents who identify themselves as hispanic or latino.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.197195442594216}, "us_population_eighteen_to_twenty_four_years_old" {"description" "The proportion of residents aged eighteen to twenty four years old.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.104294478527607}, "us_population_five_to_seventeen_years_old" {"description" "The proportion of residents aged five to seventeen years old.", "source_name" "US Census and the CGIAR Consortium for Spatial Information", "proportion_of" 2282, "value" 0.21034180543383}}, "location" {"latitude" 34.281016, "longitude" -118.766282}}]
  (coordinates2statistics [34.281016, -118.766282]))

; text2places (geodict))
(expect [{"type" "CITY", "latitude" "30.05", "longitude" "31.25", "start_index" "1", "end_index" "5", "name" "Cairo", "code" "", "matched_string" "Cairo, Egypt"}]
        (text2places "Cairo, Egypt"))

; ip2coordinates
(expect {"71.198.248.36" {"postal_code" "", "locality" "Berkeley", "latitude" 37.878101348877, "longitude" -122.271003723145, "dma_code" 807, "country_name" "United States", "region" "CA", "country_code" "US", "country_code3" "USA", "area_code" 510}}
        (ip2coordinates "71.198.248.36") )

; text2sentences
(expect {"sentences" "\"kfFJF -d a  a. This should look like a real sentence. So should this, hopefully, if things are working correctly. Blahalala. Not. A  Rea;l <<<< sentence\" \n"}
        (text2sentences "kfFJF -d a  a. This should look like a real sentence. So should this, hopefully, if things are working correctly. Blahalala. Not. A  Rea;l <<<< sentence"))

; html2text
(expect {"text" "Some text that should show up\n"}
        (html2text "<html><head><title>Foo</title><script type='text/javascript'>shouldBeIgnored();</script></head><body><p>Some text that should show up</p></body></html>"))

; html2story
; Server not giving good response
; TODO - Needs better test
;(expect {}
        ;(html2story "<html><head><title>Foo</title><script type='text/javascript'>shouldBeIgnored();</script></head><body><p>Some text that shouldn't showup</p></body></html>"))

; text2people
; TODO - Needs better test
;(expect {}
        ;(text2people "Samuel L Jackson"))

; text2times
(expect [{"time_seconds" 1.4259996E9, "time_string" "Tue Mar 10 15:00:00 +0000 2015", "duration" 1, "start_index" 0, "end_index" 16, "matched_string" "March 10th at 3pm", "is_relative" true}]
        (text2times "March 10th at 3pm \n Something that is not a time\n"))

; file2text
;(expect {}
;        (file2text ""))

; twofishes
;(expect {"interpretations" [{"what" "pizza", "where" "القاهرة", "feature" {"cc" "EG", "woeType" 7, "names" [{"name" "Cairo", "lang" "en", "flags" [16 1]} {"name" "Cairo", "lang" "en", "flags" [16]}], "name" "Cairo", "displayName" "Cairo, EG", "matchedName" "القاهرة, EG", "geometry" {"center" {"lat" 30.06263, "lng" 31.24967}, "bounds" {"ne" {"lat" 30.1480960846, "lng" 31.3563537598}, "sw" {"lat" 29.9635601044, "lng" 31.1625480652}}}, "longId" "72057594038288566", "attributes" {"adm0cap" 1, "scalerank" 0, "labelrank" 3, "natscale" 600, "population" 7734614}, "ids" [{"source" "geonameid", "id" "360630"}], "id" "geonameid:360630", "highlightedName" "<b>القاهرة</b>, EG"}, "scores" {}}]}
        ;(twofishes "pizza القاهرة"))
